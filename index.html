<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <link rel="icon" href="logo.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APavan_DOSAGEM DE CONCRETO - Aplicativo Completo com Laudo em PDF</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 25px 0;
            border-radius: 0 0 10px 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            text-align: center;
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        header p {
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .app-description {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #3498db;
        }

        .app-description h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.8rem;
        }

        .app-description ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }

        .app-description li {
            margin-bottom: 8px;
        }

        .app-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 900px) {
            .app-grid {
                grid-template-columns: 1fr;
            }
        }

        .input-section, .results-section {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }

        .input-section {
            border-top: 5px solid #2ecc71;
        }

        .results-section {
            border-top: 5px solid #e74c3c;
        }

        .section-title {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
            font-size: 1.6rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .calculate-btn {
            background: linear-gradient(to right, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 1.1rem;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            font-weight: 600;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .calculate-btn:hover {
            background: linear-gradient(to right, #2980b9, #2573a7);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .results-container {
            margin-top: 20px;
        }

        .result-item {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }

        .result-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .result-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2c3e50;
        }

        .result-unit {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-left: 5px;
        }

        .traco-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .traco-table th {
            background-color: #34495e;
            color: white;
            padding: 12px;
            text-align: center;
        }

        .traco-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }

        .traco-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .material-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .material-table th {
            background-color: #2c3e50;
            color: white;
            padding: 12px;
            text-align: left;
        }

        .material-table td {
            padding: 10px;
            border: 1px solid #ddd;
        }

        .material-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .info-box {
            background-color: #e8f4fc;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-top: 20px;
            border-radius: 0 5px 5px 0;
        }

        .warning-box {
            background-color: #fff8e1;
            border-left: 4px solid #f39c12;
            padding: 15px;
            margin-top: 20px;
            border-radius: 0 5px 5px 0;
        }

        .info-box h4, .warning-box h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .graph-section {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            margin-top: 40px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-top: 5px solid #9b59b6;
        }

        .graph-container {
            position: relative;
            height: 400px;
            margin-top: 20px;
        }

        .graph-legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            border-radius: 3px;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .methodology-section {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            margin-top: 40px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-top: 5px solid #e67e22;
        }

        .methodology-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.6rem;
        }

        .methodology-section p {
            margin-bottom: 15px;
        }

        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
            border-top: 1px solid #ecf0f1;
        }

        .highlight {
            background-color: #fffacd;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: 600;
        }

        .download-btn {
            display: inline-block;
            background-color: #27ae60;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            margin-top: 15px;
            transition: background-color 0.3s;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }

        .download-btn:hover {
            background-color: #219653;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            background-color: #f8f9fa;
            transition: all 0.3s;
        }

        .tab.active {
            background-color: white;
            border-color: #ddd;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
            font-weight: 600;
            color: #3498db;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .pdf-preview {
            background-color: white;
            border: 2px dashed #ddd;
            padding: 20px;
            margin-top: 20px;
            border-radius: 10px;
            display: none;
        }

        .pdf-preview h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .pdf-preview-content {
            max-height: 400px;
            overflow-y: auto;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }

        .pdf-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }

        .pdf-table th {
            background-color: #34495e;
            color: white;
            padding: 8px;
            text-align: left;
        }

        .pdf-table td {
            padding: 8px;
            border: 1px solid #ddd;
        }

        .pdf-header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }

        .pdf-section {
            margin-bottom: 20px;
            padding: 15px;
            border-left: 4px solid #3498db;
            background-color: #f8f9fa;
        }

        .pdf-section h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            margin-top: 20px;
            font-size: 1.2rem;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-secondary {
            background-color: #7f8c8d;
        }

        .btn-secondary:hover {
            background-color: #6c7b7d;
        }

        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            display: none;
            border-left: 4px solid #28a745;
        }

        .button-icon {
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div>
            <div class="loading-spinner"></div>
            <div class="loading-text">Gerando laudo em PDF...</div>
        </div>
    </div>

    <header>
        <div class="container">
            <img src="logo.jpeg" alt="Logo APavan Engenharia" width="100">
            <h1>APAVAN DOSAGEM DE CONCRETO - Aplicativo Completo</h1>
            <p>Com gera√ß√£o de laudo em PDF incluindo gr√°fico da Curva de Abrams</p>
        </div>
    </header>

    <div class="container">
        <section class="app-description">
            <h2>Aplicativo para Dosagem Racional de Concreto</h2>
            <p>Este aplicativo calcula a dosagem de concreto seguindo os princ√≠pios t√©cnicos descritos no manual de dosagem e gera um laudo completo em PDF com todos os dados t√©cnicos.</p>
            <ul>
                <li><strong>C√°lculo completo do tra√ßo</strong> - Seguindo normas ABNT e m√©todo INT/ABCP</li>
                <li><strong>Gr√°fico da Curva de Abrams</strong> - Rela√ß√£o √°gua/cimento vs resist√™ncia</li>
                <li><strong>Laudo em PDF</strong> - Documento t√©cnico completo para obra</li>
                <li><strong>Dados para obra</strong> - Padiolas, consumo de materiais, corre√ß√µes</li>
            </ul>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #2ecc71;"></div>
                    <span>Entrada de Dados</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e74c3c;"></div>
                    <span>Resultados da Dosagem</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #9b59b6;"></div>
                    <span>Gr√°fico de Resist√™ncia</span>
                </div>
            </div>
        </section>

        <div class="app-grid">
            <section class="input-section">
                <h2 class="section-title">Par√¢metros de Entrada</h2>
                
                <div class="form-group">
                    <label for="fck">Resist√™ncia Caracter√≠stica do Concreto (fck) - MPa</label>
                    <input type="number" id="fck" value="15" min="10" max="80" step="1">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="condicao">Condi√ß√£o de Controle (ABNT)</label>
                        <select id="condicao">
                            <option value="4.0">A - Controle rigoroso (sd = 4.0 MPa)</option>
                            <option value="5.5" selected>B - Controle intermedi√°rio (sd = 5.5 MPa)</option>
                            <option value="7.0">C - Controle simples (sd = 7.0 MPa)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="cimento">Tipo de Cimento Portland</label>
                        <select id="cimento">
                            <option value="CP I" selected>CP I - Cimento Portland Comum</option>
                            <option value="CP II-E">CP II-E - Com Esc√≥ria</option>
                            <option value="CP II-Z">CP II-Z - Com Pozolana</option>
                            <option value="CP III">CP III - Alto-Forno</option>
                            <option value="CP IV">CP IV - Pozol√¢nico</option>
                            <option value="CP V-ARI">CP V-ARI - Alta Resist√™ncia Inicial</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="dmc">Di√¢metro M√°ximo do Agregado Gra√∫do (mm)</label>
                        <select id="dmc">
                            <option value="9.5">9.5 mm (Brita 0)</option>
                            <option value="12.5">12.5 mm</option>
                            <option value="19">19 mm (Brita 1)</option>
                            <option value="25" selected>25 mm (Brita 2)</option>
                            <option value="32">32 mm (Brita 3)</option>
                            <option value="38">38 mm (Brita 4)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="adensamento">Tipo de Adensamento</label>
                        <select id="adensamento">
                            <option value="manual">Manual</option>
                            <option value="moderado" selected>Moderado (Vibra√ß√£o)</option>
                            <option value="energico">En√©rgico (Vibra√ß√£o Intensa)</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="umidade">Umidade da Areia (%)</label>
                        <input type="number" id="umidade" value="4" min="0" max="15" step="0.5">
                    </div>
                    
                    <div class="form-group">
                        <label for="inchamento">Inchamento da Areia (%)</label>
                        <input type="number" id="inchamento" value="27" min="0" max="50" step="1">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="consistencia">Consist√™ncia Desejada (Abatimento - mm)</label>
                    <select id="consistencia">
                        <option value="30">Muito baixa (0-30 mm)</option>
                        <option value="60" selected>Baixa plasticidade (30-80 mm)</option>
                        <option value="90">Pl√°stica (80-100 mm)</option>
                        <option value="150">De pl√°stica a fluida (100-200 mm)</option>
                        <option value="200">L√≠quida (‚â• 200 mm)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="obraNome">Nome da Obra (para laudo)</label>
                    <input type="text" id="obraNome" value="Edif√≠cio Residencial Sol Nascente" placeholder="Digite o nome da obra">
                </div>
                
                <button class="calculate-btn" id="calcular">CALCULAR DOSAGEM</button>
                
                <div class="info-box">
                    <h4>Informa√ß√µes T√©cnicas</h4>
                    <p>Os c√°lculos seguem a metodologia descrita no manual "DOSAGEM DE CONCRETO" utilizando:</p>
                    <ul>
                        <li>F√≥rmula: fcj = fck + 1.65 √ó sd</li>
                        <li>M√©todo do INT e ABCP para determina√ß√£o de A% e ar incorporado</li>
                        <li>Curva de Abrams para rela√ß√£o √°gua/cimento</li>
                        <li>Gr√°fico interativo da rela√ß√£o a/c vs resist√™ncia</li>
                    </ul>
                </div>
            </section>
            
            <section class="results-section">
                <div class="tabs">
                    <div class="tab active" data-tab="results">Resultados</div>
                    <div class="tab" data-tab="traco">Tra√ßo Detalhado</div>
                    <div class="tab" data-tab="pdf">Pr√©-visualiza√ß√£o PDF</div>
                </div>
                
                <div id="results-tab" class="tab-content active">
                    <h2 class="section-title">Resultados da Dosagem</h2>
                    
                    <div id="resultados-container">
                        <div class="result-item">
                            <div class="result-title">Resist√™ncia de Dosagem (fcj)</div>
                            <div class="result-value">24.1 <span class="result-unit">MPa</span></div>
                        </div>
                        
                        <div class="result-item">
                            <div class="result-title">Fator √Ågua/Cimento (a/c)</div>
                            <div class="result-value">0.60 <span class="result-unit">l/kg</span></div>
                        </div>
                        
                        <div class="result-item">
                            <div class="result-title">Consumo Te√≥rico de Cimento</div>
                            <div class="result-value">306.85 <span class="result-unit">kg/m¬≥</span></div>
                        </div>
                        
                        <div class="result-item">
                            <div class="result-title">Densidade do Concreto</div>
                            <div class="result-value">2350 <span class="result-unit">kg/m¬≥</span></div>
                        </div>
                        
                        <div class="info-box">
                            <h4>Ponto na Curva de Abrams</h4>
                            <p>O ponto calculado (a/c = <span id="ponto-a-c">0.60</span>, fcj = <span id="ponto-fcj">24.1</span> MPa) est√° destacado no gr√°fico de resist√™ncia abaixo.</p>
                            <p>Esta rela√ß√£o √°gua/cimento garante a resist√™ncia desejada considerando o tipo de cimento selecionado.</p>
                        </div>
                        
                        <div class="btn-group">
                            <button class="download-btn" id="downloadBtn">
                                <span class="button-icon">üìÑ</span> GERAR LAUDO EM PDF
                            </button>
                            <button class="download-btn btn-secondary" id="previewBtn">
                                <span class="button-icon">üëÅÔ∏è</span> PR√â-VISUALIZAR
                            </button>
                        </div>
                        
                        <div class="success-message" id="successMessage">
                            <strong>‚úì Laudo gerado com sucesso!</strong> O arquivo PDF foi baixado automaticamente.
                        </div>
                    </div>
                </div>
                
                <div id="traco-tab" class="tab-content">
                    <h2 class="section-title">Tra√ßo Detalhado</h2>
                    
                    <h3 style="margin-top: 20px; margin-bottom: 15px; color: #2c3e50;">Tra√ßo Unit√°rio em Peso Seco (TUPS)</h3>
                    <table class="traco-table">
                        <thead>
                            <tr>
                                <th>Cimento</th>
                                <th>Areia</th>
                                <th>Brita I</th>
                                <th>Brita II</th>
                                <th>√Ågua/Cimento</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>3.02</td>
                                <td>1.52</td>
                                <td>1.52</td>
                                <td>0.60</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <h3 style="margin-top: 25px; margin-bottom: 15px; color: #2c3e50;">Materiais por m¬≥ de Concreto</h3>
                    <table class="material-table">
                        <thead>
                            <tr>
                                <th>Material</th>
                                <th>Peso (kg)</th>
                                <th>Volume (L)</th>
                                <th>Volume Aparente (L)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Cimento</td>
                                <td>306.85</td>
                                <td>98.98</td>
                                <td>6.13 sacos</td>
                            </tr>
                            <tr>
                                <td>Areia (seca)</td>
                                <td>926.69</td>
                                <td>357.80</td>
                                <td>618.0</td>
                            </tr>
                            <tr>
                                <td>Brita I</td>
                                <td>466.41</td>
                                <td>172.74</td>
                                <td>333.0</td>
                            </tr>
                            <tr>
                                <td>Brita II</td>
                                <td>466.41</td>
                                <td>171.47</td>
                                <td>345.0</td>
                            </tr>
                            <tr>
                                <td>√Ågua</td>
                                <td>184.11</td>
                                <td>184.11</td>
                                <td>184.0</td>
                            </tr>
                            <tr>
                                <td>Ar Incorporado</td>
                                <td>-</td>
                                <td>15.00</td>
                                <td>-</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="warning-box">
                        <h4>Instru√ß√µes de Corre√ß√£o para Umidade</h4>
                        <p>Para cada 0.100 kg de √°gua adicionada al√©m do calculado, adicione 0.166 kg de cimento para manter a rela√ß√£o a/c constante.</p>
                        <p>√Ågua corrigida para areia √∫mida (4%): <span class="highlight">0.48 l/kg de cimento</span></p>
                    </div>
                </div>
                
                <div id="pdf-tab" class="tab-content">
                    <h2 class="section-title">Pr√©-visualiza√ß√£o do Laudo</h2>
                    <div class="pdf-preview" id="pdfPreview">
                        <div class="pdf-preview-content" id="pdfPreviewContent">
                            <!-- Conte√∫do do PDF ser√° gerado aqui -->
                        </div>
                        <div class="btn-group" style="margin-top: 15px;">
                            <button class="download-btn" id="downloadFromPreview">
                                <span class="button-icon">üì•</span> BAIXAR PDF
                            </button>
                        </div>
                    </div>
                    <div class="info-box">
                        <h4>Conte√∫do do Laudo em PDF</h4>
                        <p>O laudo gerado incluir√°:</p>
                        <ul>
                            <li>Cabe√ßalho com dados da obra e data</li>
                            <li>Par√¢metros de entrada da dosagem</li>
                            <li>Resultados calculados</li>
                            <li>Tra√ßo detalhado e consumo de materiais</li>
                            <li>Gr√°fico da Curva de Abrams</li>
                            <li>Instru√ß√µes para obra e corre√ß√µes</li>
                            <li>Refer√™ncias normativas</li>
                        </ul>
                    </div>
                </div>
            </section>
        </div>
        
        <section class="graph-section">
            <h2 class="section-title">Curva de Resist√™ncia - Abrams</h2>
            <p>Gr√°fico que mostra a rela√ß√£o entre a resist√™ncia do concreto (fcj) e a rela√ß√£o √°gua/cimento (a/c) para diferentes tipos de cimento.</p>
            
            <div class="graph-container">
                <canvas id="curvaResistencia"></canvas>
            </div>
            
            <div class="graph-legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #3498db;"></div>
                    <span>CP I - Cimento Portland Comum</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #2ecc71;"></div>
                    <span>CP III - Alto-Forno</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e74c3c;"></div>
                    <span>CP V-ARI - Alta Resist√™ncia Inicial</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background-color: #ff0000;"></div>
                    <span>Ponto Calculado</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background-color: #f39c12;"></div>
                    <span>Limite de Durabilidade (a/c m√°x)</span>
                </div>
            </div>
        </section>
        
        <section class="methodology-section">
            <h3>Metodologia T√©cnica Aplicada</h3>
            
            <p>Este aplicativo implementa a <strong>dosagem racional de concreto</strong> conforme descrito no manual t√©cnico, com √™nfase na Curva de Abrams que relaciona a resist√™ncia do concreto com a rela√ß√£o √°gua/cimento.</p>
            
            <div class="info-box">
                <h4>Refer√™ncias Normativas</h4>
                <ul>
                    <li><strong>ABNT NBR 6118</strong> - Projeto de estruturas de concreto</li>
                    <li><strong>ABNT NBR 7211</strong> - Agregados para concreto</li>
                    <li><strong>ABNT NBR 7212</strong> - Execu√ß√£o de concreto moldado no local</li>
                    <li><strong>ABNT NBR 12655</strong> - Concreto de cimento Portland - Preparo, controle e recebimento</li>
                    <li><strong>Manual "DOSAGEM DE CONCRETO"</strong> - Idercio Fran√ßa das Neves & Ernesto Sperandio Neto</li>
                    <li><strong>Abrams, D.A.</strong> - Design of Concrete Mixtures (1919)</li>
                </ul>
            </div>
        </section>
    </div>
    
    <footer>
        <div class="container">
            <p>Aplicativo desenvolvido com base no manual "DOSAGEM DE CONCRETO" - APAVAN ENGENHARIA - Eng. Ademilton Pavan</p>
            <p>Vers√£o 3.0 - Com gera√ß√£o de laudo em PDF - Para uso t√©cnico em obras de engenharia civil</p>
            <p>¬© 2023 - Todos os direitos reservados</p>
        </div>
    </footer>

    <script>
        // Vari√°veis globais
        let resistenciaChart;
        let currentAC = 0.60;
        let currentFCJ = 24.1;
        let currentCimentoType = "CP I";
        let dosagemData = {};
        
        // Inicializar quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar eventos
            document.getElementById('calcular').addEventListener('click', calcularDosagem);
            document.getElementById('downloadBtn').addEventListener('click', gerarLaudoPDF);
            document.getElementById('previewBtn').addEventListener('click', previewLaudo);
            document.getElementById('downloadFromPreview').addEventListener('click', gerarLaudoPDF);
            
            // Configurar tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remover classe active de todas as tabs
                    document.querySelectorAll('.tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    // Adicionar classe active na tab clicada
                    this.classList.add('active');
                    
                    // Esconder todos os conte√∫dos
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Mostrar o conte√∫do correspondente
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                    
                    // Mostrar preview do PDF se for a tab de PDF
                    if (tabId === 'pdf' && Object.keys(dosagemData).length > 0) {
                        mostrarPreviewLaudo();
                    }
                });
            });
            
            // Criar gr√°fico inicial
            criarGraficoCurvaAbrams();
            
            // Calcular dosagem inicial
            calcularDosagem();
        });
        
        // Tabelas de refer√™ncia do manual
        const tabelaApercent = {
            "9.5": { manual: 11.5, moderado: 10.5, energico: 9.5 },
            "12.5": { manual: 11.0, moderado: 10.0, energico: 9.0 },
            "19": { manual: 10.0, moderado: 9.0, energico: 8.0 },
            "25": { manual: 9.5, moderado: 8.5, energico: 7.5 },
            "32": { manual: 9.7, moderado: 8.2, energico: 7.3 },
            "38": { manual: 9.0, moderado: 8.0, energico: 7.0 }
        };
        
        const tabelaAr = {
            "9.5": 3.5,
            "12.5": 3.0,
            "19": 2.5,
            "25": 1.5,
            "32": 1.0,
            "38": 1.0
        };
        
        // Fun√ß√£o para calcular resist√™ncia baseada na rela√ß√£o a/c (Curva de Abrams)
        function calcularResistenciaPorAC(a_c, tipoCimento) {
            // Par√¢metros para diferentes tipos de cimento
            const parametros = {
                "CP I": { K: 14.5, n: 1.3 },
                "CP II-E": { K: 15.0, n: 1.3 },
                "CP II-Z": { K: 15.5, n: 1.3 },
                "CP III": { K: 16.0, n: 1.25 },
                "CP IV": { K: 15.8, n: 1.25 },
                "CP V-ARI": { K: 18.0, n: 1.4 }
            };
            
            const params = parametros[tipoCimento] || parametros["CP I"];
            
            // Evitar valores extremos
            if (a_c <= 0.3) a_c = 0.3;
            if (a_c >= 0.9) a_c = 0.9;
            
            return params.K / Math.pow(a_c, params.n);
        }
        
        // Fun√ß√£o inversa: calcular a/c baseado na resist√™ncia
        function getFatorAguaCimento(fcj, tipoCimento) {
            const parametros = {
                "CP I": { K: 14.5, n: 1.3 },
                "CP II-E": { K: 15.0, n: 1.3 },
                "CP II-Z": { K: 15.5, n: 1.3 },
                "CP III": { K: 16.0, n: 1.25 },
                "CP IV": { K: 15.8, n: 1.25 },
                "CP V-ARI": { K: 18.0, n: 1.4 }
            };
            
            const params = parametros[tipoCimento] || parametros["CP I"];
            
            // Calcular a/c a partir da resist√™ncia: a/c = (K/fcj)^(1/n)
            return Math.pow(params.K / fcj, 1/params.n);
        }
        
        // Criar gr√°fico da Curva de Abrams
        function criarGraficoCurvaAbrams() {
            const ctx = document.getElementById('curvaResistencia').getContext('2d');
            
            // Gerar dados para as curvas
            const a_cValues = Array.from({length: 13}, (_, i) => 0.3 + i * 0.05);
            
            // Dados para diferentes tipos de cimento
            const cp1Data = a_cValues.map(a_c => ({
                x: a_c,
                y: calcularResistenciaPorAC(a_c, "CP I")
            }));
            
            const cp3Data = a_cValues.map(a_c => ({
                x: a_c,
                y: calcularResistenciaPorAC(a_c, "CP III")
            }));
            
            const cp5Data = a_cValues.map(a_c => ({
                x: a_c,
                y: calcularResistenciaPorAC(a_c, "CP V-ARI")
            }));
            
            // Configurar o gr√°fico
            resistenciaChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'CP I - Cimento Portland Comum',
                            data: cp1Data,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.3
                        },
                        {
                            label: 'CP III - Alto-Forno',
                            data: cp3Data,
                            borderColor: '#2ecc71',
                            backgroundColor: 'rgba(46, 204, 113, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.3
                        },
                        {
                            label: 'CP V-ARI - Alta Resist√™ncia Inicial',
                            data: cp5Data,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.3
                        },
                        {
                            label: 'Ponto Calculado',
                            data: [{x: currentAC, y: currentFCJ}],
                            backgroundColor: 'rgba(255, 0, 0, 1)',
                            borderColor: 'rgba(255, 0, 0, 1)',
                            pointRadius: 8,
                            pointHoverRadius: 12,
                            showLine: false,
                            pointStyle: 'circle'
                        },
                        {
                            label: 'Limite de Durabilidade',
                            data: [
                                {x: 0.65, y: 10},
                                {x: 0.65, y: 60}
                            ],
                            borderColor: 'rgba(243, 156, 18, 0.7)',
                            backgroundColor: 'rgba(243, 156, 18, 0.1)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.dataset.label === 'Ponto Calculado') {
                                        return `Ponto calculado: a/c = ${currentAC.toFixed(2)}, fcj = ${currentFCJ.toFixed(1)} MPa`;
                                    } else if (context.dataset.label === 'Limite de Durabilidade') {
                                        return 'Limite m√°ximo a/c para durabilidade: 0.65';
                                    } else {
                                        return `${context.dataset.label}: a/c = ${context.parsed.x.toFixed(2)}, fcj = ${context.parsed.y.toFixed(1)} MPa`;
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Rela√ß√£o √Ågua/Cimento (a/c)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            min: 0.3,
                            max: 0.9,
                            ticks: {
                                stepSize: 0.05
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Resist√™ncia (fcj) - MPa',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            min: 10,
                            max: 60,
                            ticks: {
                                stepSize: 5
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }
        
        // Atualizar gr√°fico com novo ponto calculado
        function atualizarGrafico(a_c, fcj, tipoCimento) {
            currentAC = a_c;
            currentFCJ = fcj;
            currentCimentoType = tipoCimento;
            
            // Atualizar ponto no gr√°fico
            resistenciaChart.data.datasets[3].data = [{x: a_c, y: fcj}];
            
            // Atualizar legenda do ponto
            document.getElementById('ponto-a-c').textContent = a_c.toFixed(2);
            document.getElementById('ponto-fcj').textContent = fcj.toFixed(1);
            
            // Destacar a curva do cimento selecionado
            resistenciaChart.data.datasets.forEach((dataset, index) => {
                if (index < 3) {
                    if ((tipoCimento === "CP I" && index === 0) ||
                        (tipoCimento === "CP III" && index === 1) ||
                        (tipoCimento.includes("ARI") && index === 2)) {
                        dataset.borderWidth = 4;
                        dataset.borderColor = dataset.borderColor;
                    } else {
                        dataset.borderWidth = 2;
                        dataset.borderColor = dataset.borderColor.replace(')', ', 0.5)').replace('rgb', 'rgba');
                    }
                }
            });
            
            resistenciaChart.update();
        }
        
        // Calcular dosagem completa
        function calcularDosagem() {
            // Obter valores dos inputs
            const fck = parseFloat(document.getElementById('fck').value);
            const sd = parseFloat(document.getElementById('condicao').value);
            const tipoCimento = document.getElementById('cimento').value;
            const dmc = document.getElementById('dmc').value;
            const tipoAdensamento = document.getElementById('adensamento').value;
            const umidade = parseFloat(document.getElementById('umidade').value);
            const inchamento = parseFloat(document.getElementById('inchamento').value);
            const obraNome = document.getElementById('obraNome').value;
            const consistencia = document.getElementById('consistencia').value;
            
            // 1. Calcular fcj
            const fcj = fck + 1.65 * sd;
            
            // 2. Determinar fator a/c baseado na Curva de Abrams
            const a_c = getFatorAguaCimento(fcj, tipoCimento);
            
            // 3. Determinar A% e ar incorporado
            const Apercent = tabelaApercent[dmc][tipoAdensamento];
            const arIncorporado = tabelaAr[dmc];
            
            // 4. Calcular M (rela√ß√£o agregados/cimento)
            const M = (a_c * 100 / Apercent) - 1;
            
            // 5. Composi√ß√£o dos agregados
            const percentAreia = 50;
            const percentBritas = 50;
            const percentBritaI = 50;
            const percentBritaII = 50;
            
            // 6. Calcular TUPS
            const areiaTUPS = M * percentAreia / 100;
            const britasTUPS = M * percentBritas / 100;
            const britaITUPS = britasTUPS * percentBritaI / 100;
            const britaIITUPS = britasTUPS * percentBritaII / 100;
            
            // 7. Consumo te√≥rico de cimento (CT)
            const deltaCimento = 3.10;
            const deltaAreia = 2.59;
            const deltaBritaI = 2.70;
            const deltaBritaII = 2.72;
            const deltaAgua = 1.00;
            
            // Volume de ar em litros/m¬≥
            const volumeAr = arIncorporado / 100 * 1000;
            
            // CT = (1000 - %ar) / (1/Œ¥c + A/Œ¥a + B/Œ¥b + a/c)
            const CT = (1000 - volumeAr) / (1/deltaCimento + areiaTUPS/deltaAreia + britaITUPS/deltaBritaI + britaIITUPS/deltaBritaII + a_c/deltaAgua);
            
            // 8. Pesos dos materiais para 1 m¬≥
            const pesoCimento = CT;
            const pesoAreiaSeca = CT * areiaTUPS;
            const pesoBritaI = CT * britaITUPS;
            const pesoBritaII = CT * britaIITUPS;
            const pesoAgua = CT * a_c;
            
            // 9. Volumes absolutos
            const volAbsCimento = pesoCimento / deltaCimento;
            const volAbsAreia = pesoAreiaSeca / deltaAreia;
            const volAbsBritaI = pesoBritaI / deltaBritaI;
            const volAbsBritaII = pesoBritaII / deltaBritaII;
            const volAbsAgua = pesoAgua / deltaAgua;
            
            // 10. Pesos unit√°rios soltos
            const PUSAreia = 1.50;
            const PUSBritaI = 1.40;
            const PUSBritaII = 1.35;
            
            // 11. Volumes aparentes
            const volApAreia = pesoAreiaSeca / PUSAreia;
            const volApBritaI = pesoBritaI / PUSBritaI;
            const volApBritaII = pesoBritaII / PUSBritaII;
            
            // 12. Densidade do concreto
            const densidadeConcreto = pesoCimento + pesoAreiaSeca + pesoBritaI + pesoBritaII + pesoAgua;
            
            // 13. Corre√ß√£o para umidade da areia
            const areiaUmidaTUPS = areiaTUPS * (100 + umidade) / 100;
            const aguaCorrigida = a_c - (areiaUmidaTUPS - areiaTUPS);
            
            // 14. Tra√ßo em volume inchado
            const areiaInchadaTUVI = areiaTUPS * (100 + inchamento) / 100 / PUSAreia;
            const britaITUVI = britaITUPS / PUSBritaI;
            const britaIITUVI = britaIITUPS / PUSBritaII;
            
            // 15. Armazenar dados para uso posterior
            dosagemData = {
                fck, sd, tipoCimento, dmc, tipoAdensamento, umidade, inchamento, obraNome, consistencia,
                fcj, a_c, Apercent, arIncorporado, M, percentAreia, percentBritas, percentBritaI, percentBritaII,
                areiaTUPS, britaITUPS, britaIITUPS, CT, pesoCimento, pesoAreiaSeca, pesoBritaI, pesoBritaII, pesoAgua,
                volAbsCimento, volAbsAreia, volAbsBritaI, volAbsBritaII, volAbsAgua,
                PUSAreia, PUSBritaI, PUSBritaII,
                volApAreia, volApBritaI, volApBritaII,
                densidadeConcreto, areiaUmidaTUPS, aguaCorrigida, areiaInchadaTUVI, britaITUVI, britaIITUVI,
                volumeAr, deltaCimento, deltaAreia, deltaBritaI, deltaBritaII, deltaAgua
            };
            
            // Atualizar interface
            atualizarInterface();
            
            // Atualizar gr√°fico
            atualizarGrafico(a_c, fcj, tipoCimento);
            
            // Mostrar mensagem de sucesso
            mostrarMensagem('Dosagem calculada com sucesso!', 'success');
        }
        
        // Atualizar interface com resultados
        function atualizarInterface() {
            const d = dosagemData;
            
            // Atualizar resultados principais
            document.querySelector('#resultados-container .result-item:nth-child(1) .result-value').innerHTML = 
                `${d.fcj.toFixed(1)} <span class="result-unit">MPa</span>`;
            
            document.querySelector('#resultados-container .result-item:nth-child(2) .result-value').innerHTML = 
                `${d.a_c.toFixed(2)} <span class="result-unit">l/kg</span>`;
            
            document.querySelector('#resultados-container .result-item:nth-child(3) .result-value').innerHTML = 
                `${d.CT.toFixed(2)} <span class="result-unit">kg/m¬≥</span>`;
            
            document.querySelector('#resultados-container .result-item:nth-child(4) .result-value').innerHTML = 
                `${d.densidadeConcreto.toFixed(0)} <span class="result-unit">kg/m¬≥</span>`;
            
            // Atualizar tabela do TUPS
            document.querySelector('.traco-table tbody tr td:nth-child(1)').textContent = '1';
            document.querySelector('.traco-table tbody tr td:nth-child(2)').textContent = d.areiaTUPS.toFixed(2);
            document.querySelector('.traco-table tbody tr td:nth-child(3)').textContent = d.britaITUPS.toFixed(2);
            document.querySelector('.traco-table tbody tr td:nth-child(4)').textContent = d.britaIITUPS.toFixed(2);
            document.querySelector('.traco-table tbody tr td:nth-child(5)').textContent = d.a_c.toFixed(2);
            
            // Atualizar tabela de materiais por m¬≥
            document.querySelector('.material-table tbody tr:nth-child(1) td:nth-child(2)').textContent = d.pesoCimento.toFixed(2);
            document.querySelector('.material-table tbody tr:nth-child(1) td:nth-child(3)').textContent = d.volAbsCimento.toFixed(2);
            document.querySelector('.material-table tbody tr:nth-child(1) td:nth-child(4)').textContent = (d.pesoCimento / 50).toFixed(2) + ' sacos';
            
            document.querySelector('.material-table tbody tr:nth-child(2) td:nth-child(2)').textContent = d.pesoAreiaSeca.toFixed(2);
            document.querySelector('.material-table tbody tr:nth-child(2) td:nth-child(3)').textContent = d.volAbsAreia.toFixed(2);
            document.querySelector('.material-table tbody tr:nth-child(2) td:nth-child(4)').textContent = d.volApAreia.toFixed(1);
            
            document.querySelector('.material-table tbody tr:nth-child(3) td:nth-child(2)').textContent = d.pesoBritaI.toFixed(2);
            document.querySelector('.material-table tbody tr:nth-child(3) td:nth-child(3)').textContent = d.volAbsBritaI.toFixed(2);
            document.querySelector('.material-table tbody tr:nth-child(3) td:nth-child(4)').textContent = d.volApBritaI.toFixed(1);
            
            document.querySelector('.material-table tbody tr:nth-child(4) td:nth-child(2)').textContent = d.pesoBritaII.toFixed(2);
            document.querySelector('.material-table tbody tr:nth-child(4) td:nth-child(3)').textContent = d.volAbsBritaII.toFixed(2);
            document.querySelector('.material-table tbody tr:nth-child(4) td:nth-child(4)').textContent = d.volApBritaII.toFixed(1);
            
            document.querySelector('.material-table tbody tr:nth-child(5) td:nth-child(2)').textContent = d.pesoAgua.toFixed(2);
            document.querySelector('.material-table tbody tr:nth-child(5) td:nth-child(3)').textContent = d.volAbsAgua.toFixed(2);
            document.querySelector('.material-table tbody tr:nth-child(5) td:nth-child(4)').textContent = d.volAbsAgua.toFixed(1);
            
            document.querySelector('.material-table tbody tr:nth-child(6) td:nth-child(3)').textContent = d.volumeAr.toFixed(2);
            
            // Atualizar informa√ß√£o de corre√ß√£o
            document.querySelector('.warning-box p:last-child').innerHTML = 
                `√Ågua corrigida para areia √∫mida (${d.umidade}%): <span class="highlight">${d.aguaCorrigida.toFixed(2)} l/kg de cimento</span>`;
        }
        
        // Mostrar pr√©-visualiza√ß√£o do laudo
        function previewLaudo() {
            mostrarPreviewLaudo();
            
            // Ativar a tab de PDF
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector('.tab[data-tab="pdf"]').classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById('pdf-tab').classList.add('active');
        }
        
        // Mostrar preview do laudo
        function mostrarPreviewLaudo() {
            const d = dosagemData;
            const previewContent = document.getElementById('pdfPreviewContent');
            
            if (Object.keys(d).length === 0) {
                previewContent.innerHTML = '<p>Calcule uma dosagem primeiro para visualizar o laudo.</p>';
                return;
            }
            
            // Formatar data atual
            const dataAtual = new Date().toLocaleDateString('pt-BR');
            
            // Construir conte√∫do do preview
            let html = `
                <div class="pdf-header">
                    <h2>LAUDO T√âCNICO DE DOSAGEM DE CONCRETO</h2>
                    <p>Obra: ${d.obraNome}</p>
                    <p>Data: ${dataAtual}</p>
                </div>
                
                <div class="pdf-section">
                    <h4>1. PAR√ÇMETROS DE ENTRADA</h4>
                    <table class="pdf-table">
                        <tr><th>Par√¢metro</th><th>Valor</th></tr>
                        <tr><td>Resist√™ncia caracter√≠stica (fck)</td><td>${d.fck} MPa</td></tr>
                        <tr><td>Tipo de cimento</td><td>${d.tipoCimento}</td></tr>
                        <tr><td>Di√¢metro m√°ximo do agregado</td><td>${d.dmc} mm</td></tr>
                        <tr><td>Tipo de adensamento</td><td>${d.tipoAdensamento}</td></tr>
                        <tr><td>Umidade da areia</td><td>${d.umidade}%</td></tr>
                        <tr><td>Inchamento da areia</td><td>${d.inchamento}%</td></tr>
                        <tr><td>Consist√™ncia (abatimento)</td><td>${d.consistencia} mm</td></tr>
                    </table>
                </div>
                
                <div class="pdf-section">
                    <h4>2. RESULTADOS DA DOSAGEM</h4>
                    <table class="pdf-table">
                        <tr><th>Item</th><th>Valor</th></tr>
                        <tr><td>Resist√™ncia de dosagem (fcj)</td><td>${d.fcj.toFixed(1)} MPa</td></tr>
                        <tr><td>Fator √°gua/cimento (a/c)</td><td>${d.a_c.toFixed(2)}</td></tr>
                        <tr><td>Consumo te√≥rico de cimento</td><td>${d.CT.toFixed(2)} kg/m¬≥</td></tr>
                        <tr><td>Densidade do concreto</td><td>${d.densidadeConcreto.toFixed(0)} kg/m¬≥</td></tr>
                        <tr><td>Ar incorporado</td><td>${d.arIncorporado}%</td></tr>
                    </table>
                </div>
                
                <div class="pdf-section">
                    <h4>3. TRA√áO UNIT√ÅRIO EM PESO SECO (TUPS)</h4>
                    <table class="pdf-table">
                        <tr>
                            <th>Cimento</th>
                            <th>Areia</th>
                            <th>Brita I</th>
                            <th>Brita II</th>
                            <th>√Ågua/Cimento</th>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>${d.areiaTUPS.toFixed(2)}</td>
                            <td>${d.britaITUPS.toFixed(2)}</td>
                            <td>${d.britaIITUPS.toFixed(2)}</td>
                            <td>${d.a_c.toFixed(2)}</td>
                        </tr>
                    </table>
                </div>
                
                <div class="pdf-section">
                    <h4>4. MATERIAIS POR m¬≥ DE CONCRETO</h4>
                    <table class="pdf-table">
                        <tr><th>Material</th><th>Peso (kg)</th><th>Volume Absoluto (L)</th><th>Volume Aparente (L)</th></tr>
                        <tr><td>Cimento</td><td>${d.pesoCimento.toFixed(2)}</td><td>${d.volAbsCimento.toFixed(2)}</td><td>${(d.pesoCimento/50).toFixed(2)} sacos</td></tr>
                        <tr><td>Areia (seca)</td><td>${d.pesoAreiaSeca.toFixed(2)}</td><td>${d.volAbsAreia.toFixed(2)}</td><td>${d.volApAreia.toFixed(1)}</td></tr>
                        <tr><td>Brita I</td><td>${d.pesoBritaI.toFixed(2)}</td><td>${d.volAbsBritaI.toFixed(2)}</td><td>${d.volApBritaI.toFixed(1)}</td></tr>
                        <tr><td>Brita II</td><td>${d.pesoBritaII.toFixed(2)}</td><td>${d.volAbsBritaII.toFixed(2)}</td><td>${d.volApBritaII.toFixed(1)}</td></tr>
                        <tr><td>√Ågua</td><td>${d.pesoAgua.toFixed(2)}</td><td>${d.volAbsAgua.toFixed(2)}</td><td>${d.volAbsAgua.toFixed(1)}</td></tr>
                        <tr><td>Ar incorporado</td><td>-</td><td>${d.volumeAr.toFixed(2)}</td><td>-</td></tr>
                    </table>
                </div>
                
                <div class="pdf-section">
                    <h4>5. INSTRU√á√ïES PARA OBRA</h4>
                    <p><strong>Corre√ß√£o para umidade da areia (${d.umidade}%):</strong></p>
                    <p>‚Ä¢ √Ågua corrigida: ${d.aguaCorrigida.toFixed(2)} l/kg de cimento</p>
                    <p>‚Ä¢ Para cada 0.100 kg de √°gua adicionada al√©m do calculado, adicionar ${(1/d.a_c).toFixed(3)} kg de cimento</p>
                    <p><strong>Tra√ßo em volume para 1 saco de cimento (50 kg):</strong></p>
                    <p>‚Ä¢ Areia (inchada ${d.inchamento}%): ${(d.areiaInchadaTUVI*50).toFixed(1)} L</p>
                    <p>‚Ä¢ Brita I: ${(d.britaITUVI*50).toFixed(1)} L</p>
                    <p>‚Ä¢ Brita II: ${(d.britaIITUVI*50).toFixed(1)} L</p>
                    <p>‚Ä¢ √Ågua: ${(d.aguaCorrigida*50).toFixed(1)} L</p>
                </div>
                
                <div class="pdf-section">
                    <h4>6. CURVA DE ABRAMS</h4>
                    <p>O ponto calculado (a/c = ${d.a_c.toFixed(2)}, fcj = ${d.fcj.toFixed(1)} MPa) est√° destacado no gr√°fico da Curva de Abrams.</p>
                    <p><em>Nota: O gr√°fico completo ser√° inclu√≠do no PDF gerado.</em></p>
                </div>
                
                <div class="pdf-section">
                    <h4>7. REFER√äNCIAS NORMATIVAS</h4>
                    <p>‚Ä¢ ABNT NBR 6118 - Projeto de estruturas de concreto</p>
                    <p>‚Ä¢ ABNT NBR 7211 - Agregados para concreto</p>
                    <p>‚Ä¢ ABNT NBR 12655 - Concreto de cimento Portland</p>
                    <p>‚Ä¢ Manual "DOSAGEM DE CONCRETO" - Idercio Fran√ßa das Neves & Ernesto Sperandio Neto</p>
                </div>
            `;
            
            previewContent.innerHTML = html;
            document.getElementById('pdfPreview').style.display = 'block';
        }
        
        // Gerar laudo em PDF
        async function gerarLaudoPDF() {
            if (Object.keys(dosagemData).length === 0) {
                mostrarMensagem('Calcule uma dosagem primeiro antes de gerar o laudo.', 'error');
                return;
            }
            
            // Mostrar overlay de carregamento
            document.getElementById('loadingOverlay').style.display = 'flex';
            
            try {
                const d = dosagemData;
                const dataAtual = new Date().toLocaleDateString('pt-BR');
                
                // Criar novo documento PDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                
                // Configura√ß√µes do PDF
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const margin = 15;
                const contentWidth = pageWidth - 2 * margin;
                
                // Fun√ß√£o para quebrar texto em m√∫ltiplas linhas
                function splitText(text, maxWidth) {
                    return doc.splitTextToSize(text, maxWidth);
                }
                
                // 1. CABE√áALHO
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.text('LAUDO T√âCNICO DE DOSAGEM DE CONCRETO', pageWidth/2, margin, { align: 'center' });
                
                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                doc.text(`Obra: ${d.obraNome}`, margin, margin + 10);
                doc.text(`Data: ${dataAtual}`, pageWidth - margin, margin + 10, { align: 'right' });
                
                // Linha divis√≥ria
                doc.setDrawColor(200, 200, 200);
                doc.line(margin, margin + 15, pageWidth - margin, margin + 15);
                
                let yPos = margin + 25;
                
                // 2. PAR√ÇMETROS DE ENTRADA
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('1. PAR√ÇMETROS DE ENTRADA', margin, yPos);
                yPos += 10;
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                
                const parametros = [
                    ['Resist√™ncia caracter√≠stica (fck)', `${d.fck} MPa`],
                    ['Tipo de cimento', d.tipoCimento],
                    ['Di√¢metro m√°ximo do agregado', `${d.dmc} mm`],
                    ['Tipo de adensamento', d.tipoAdensamento],
                    ['Umidade da areia', `${d.umidade}%`],
                    ['Inchamento da areia', `${d.inchamento}%`],
                    ['Consist√™ncia (abatimento)', `${d.consistencia} mm`],
                    ['Condi√ß√£o de controle', `sd = ${d.sd} MPa`]
                ];
                
                parametros.forEach(([param, valor], index) => {
                    if (yPos > pageHeight - 30) {
                        doc.addPage();
                        yPos = margin;
                    }
                    
                    doc.text(`${param}:`, margin, yPos);
                    doc.text(valor, pageWidth - margin, yPos, { align: 'right' });
                    yPos += 7;
                });
                
                yPos += 5;
                
                // 3. RESULTADOS DA DOSAGEM
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('2. RESULTADOS DA DOSAGEM', margin, yPos);
                yPos += 10;
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                
                const resultados = [
                    ['Resist√™ncia de dosagem (fcj)', `${d.fcj.toFixed(1)} MPa`],
                    ['Fator √°gua/cimento (a/c)', d.a_c.toFixed(2)],
                    ['Consumo te√≥rico de cimento', `${d.CT.toFixed(2)} kg/m¬≥`],
                    ['Densidade do concreto', `${d.densidadeConcreto.toFixed(0)} kg/m¬≥`],
                    ['Ar incorporado', `${d.arIncorporado}%`],
                    ['Rela√ß√£o √°gua/mistura seca (A%)', `${d.Apercent}%`]
                ];
                
                resultados.forEach(([item, valor], index) => {
                    if (yPos > pageHeight - 30) {
                        doc.addPage();
                        yPos = margin;
                    }
                    
                    doc.text(`${item}:`, margin, yPos);
                    doc.text(valor, pageWidth - margin, yPos, { align: 'right' });
                    yPos += 7;
                });
                
                yPos += 5;
                
                // 4. TRA√áO UNIT√ÅRIO
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('3. TRA√áO UNIT√ÅRIO EM PESO SECO (TUPS)', margin, yPos);
                yPos += 15;
                
                // Cabe√ßalho da tabela
                doc.setFillColor(52, 73, 94);
                doc.rect(margin, yPos - 5, contentWidth, 8, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFont('helvetica', 'bold');
                
                const colWidth = contentWidth / 5;
                const headers = ['Cimento', 'Areia', 'Brita I', 'Brita II', '√Ågua/Cimento'];
                
                headers.forEach((header, i) => {
                    doc.text(header, margin + i * colWidth + colWidth/2, yPos - 1, { align: 'center' });
                });
                
                // Dados da tabela
                doc.setTextColor(0, 0, 0);
                doc.setFont('helvetica', 'normal');
                yPos += 8;
                
                const valores = ['1', d.areiaTUPS.toFixed(2), d.britaITUPS.toFixed(2), d.britaIITUPS.toFixed(2), d.a_c.toFixed(2)];
                
                valores.forEach((valor, i) => {
                    doc.text(valor, margin + i * colWidth + colWidth/2, yPos, { align: 'center' });
                });
                
                yPos += 15;
                
                // 5. MATERIAIS POR m¬≥
                if (yPos > pageHeight - 100) {
                    doc.addPage();
                    yPos = margin;
                }
                
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('4. MATERIAIS POR m¬≥ DE CONCRETO', margin, yPos);
                yPos += 10;
                
                // Capturar o gr√°fico como imagem
                const canvas = document.getElementById('curvaResistencia');
                const chartImage = canvas.toDataURL('image/png');
                
                // Adicionar gr√°fico ao PDF
                if (yPos > pageHeight - 150) {
                    doc.addPage();
                    yPos = margin;
                }
                
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('5. CURVA DE ABRAMS', margin, yPos);
                yPos += 10;
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.text(`Ponto calculado: a/c = ${d.a_c.toFixed(2)}, fcj = ${d.fcj.toFixed(1)} MPa`, margin, yPos);
                yPos += 10;
                
                // Adicionar imagem do gr√°fico
                const imgWidth = contentWidth;
                const imgHeight = 80;
                
                doc.addImage(chartImage, 'PNG', margin, yPos, imgWidth, imgHeight);
                yPos += imgHeight + 15;
                
                // 6. INSTRU√á√ïES PARA OBRA
                if (yPos > pageHeight - 80) {
                    doc.addPage();
                    yPos = margin;
                }
                
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('6. INSTRU√á√ïES PARA OBRA', margin, yPos);
                yPos += 10;
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                
                const instrucoes = [
                    `Corre√ß√£o para umidade da areia (${d.umidade}%):`,
                    `‚Ä¢ √Ågua corrigida: ${d.aguaCorrigida.toFixed(2)} l/kg de cimento`,
                    `‚Ä¢ Para cada 0.100 kg de √°gua adicionada al√©m do calculado, adicionar ${(1/d.a_c).toFixed(3)} kg de cimento`,
                    ``,
                    `Tra√ßo em volume para 1 saco de cimento (50 kg):`,
                    `‚Ä¢ Areia (inchada ${d.inchamento}%): ${(d.areiaInchadaTUVI*50).toFixed(1)} L`,
                    `‚Ä¢ Brita I: ${(d.britaITUVI*50).toFixed(1)} L`,
                    `‚Ä¢ Brita II: ${(d.britaIITUVI*50).toFixed(1)} L`,
                    `‚Ä¢ √Ågua: ${(d.aguaCorrigida*50).toFixed(1)} L`,
                    ``,
                    `Ordem de mistura na betoneira:`,
                    `1. Parte da √°gua`,
                    `2. Aproximadamente metade da brita`,
                    `3. Toda a areia`,
                    `4. Todo o cimento`,
                    `5. Restante da brita`,
                    `6. Restante da √°gua (adicionar gradativamente)`
                ];
                
                instrucoes.forEach(instrucao => {
                    if (yPos > pageHeight - 10) {
                        doc.addPage();
                        yPos = margin;
                    }
                    
                    doc.text(instrucao, margin, yPos);
                    yPos += 5;
                });
                
                // 7. RODAP√â COM REFER√äNCIAS
                doc.addPage();
                yPos = margin;
                
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('7. REFER√äNCIAS NORMATIVAS', margin, yPos);
                yPos += 10;
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                
                const referencias = [
                    'ABNT NBR 6118 - Projeto de estruturas de concreto',
                    'ABNT NBR 7211 - Agregados para concreto',
                    'ABNT NBR 7212 - Execu√ß√£o de concreto moldado no local',
                    'ABNT NBR 12655 - Concreto de cimento Portland - Preparo, controle e recebimento',
                    'Manual "DOSAGEM DE CONCRETO" - Idercio Fran√ßa das Neves & Ernesto Sperandio Neto',
                    'Abrams, D.A. - Design of Concrete Mixtures (1919)'
                ];
                
                referencias.forEach(ref => {
                    doc.text(`‚Ä¢ ${ref}`, margin, yPos);
                    yPos += 6;
                });
                
                yPos += 10;
                
                // Assinatura
                doc.setFontSize(10);
                doc.setFont('helvetica', 'italic');
                doc.text('________________________________________', pageWidth/2, yPos, { align: 'center' });
                doc.text('Engenheiro Respons√°vel', pageWidth/2, yPos + 5, { align: 'center' });
                
                // Salvar PDF
                const fileName = `Laudo_Dosagem_${d.obraNome.replace(/\s+/g, '_')}_${dataAtual.replace(/\//g, '-')}.pdf`;
                doc.save(fileName);
                
                // Esconder overlay de carregamento
                document.getElementById('loadingOverlay').style.display = 'none';
                
                // Mostrar mensagem de sucesso
                mostrarMensagem('Laudo gerado com sucesso! O PDF foi baixado.', 'success');
                
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                document.getElementById('loadingOverlay').style.display = 'none';
                mostrarMensagem('Erro ao gerar o laudo em PDF. Tente novamente.', 'error');
            }
        }
        
        // Mostrar mensagem de feedback
        function mostrarMensagem(texto, tipo) {
            const mensagem = document.getElementById('successMessage');
            mensagem.textContent = texto;
            
            if (tipo === 'success') {
                mensagem.style.backgroundColor = '#d4edda';
                mensagem.style.color = '#155724';
                mensagem.style.borderLeftColor = '#28a745';
            } else {
                mensagem.style.backgroundColor = '#f8d7da';
                mensagem.style.color = '#721c24';
                mensagem.style.borderLeftColor = '#dc3545';
            }
            
            mensagem.style.display = 'block';
            
            // Esconder mensagem ap√≥s 5 segundos
            setTimeout(() => {
                mensagem.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
